inputs:
    #- Stdin:
        #codec: json
        #type: stdin1
    - Kafka:
        topic:
            fx.cat.log.booking: 1
        codec: json
        consumer_settings:
            bootstrap.servers: "10.2.74.6:9092"
            key.deserializer: org.apache.kafka.common.serialization.IntegerDeserializer
            value.deserializer: com.ctrip.ops.sysdev.serialization.DALDeserializer
            group.id: hangout.test

filters:
    #- Add:
        #fields:
            #'[p][name][first]': liujia
    - Grok:
        src: message
        match:
            - '^(?P<user>\w+) (?P<status>\d+)$'
        remove_fields: ['message']
    #- Date:
        #timezone: 'Asia/Shanghai'
        #src: logtime
        #locale: en
        #formats:
            #- 'dd/MMM/YYYY:HH:mm:ss Z'
        #remove_fields: ["logtime"]
    #- Drop:
        #if:
            #- '<#if statusCode?? && statusCode=="200">true</#if>'
            #- '<#if @timestamp??>true</#if>'
            #- '<#assign x=@timestamp.getMillis() / 1000 % 10><#if x!=0>true</#if>'
            #- '<#if requestUri?? && requestUri!="/frt-resource-mixture-ws/api/bjjson/xSearch">true</#if>'
    #- Grok:
        #src: rest
        #match:
            #- '^%{NUMBER:requestLength} %{NUMBER:bodyBytesSent} %{NUMBER:request_time} (-|%{NUMBER:upstream_responseTime}) (-|%{NOTSPACE:upstreamAddr}) (-|%{NUMBER:upstreamStatus}) %{NOTSPACE:proxy_host} %{NOTSPACE:policy_name}\s+%{NOTSPACE:via} %{NOTSPACE:http_cat_meta}$'
        #remove_fields: ['rest']

outputs:
    #- Stdout: {}
    - Elasticsearch:
        hosts:
            - http://127.0.0.1:9200
            #- 127.0.0.1:9201
        index: 'test'
        index_type: "logs"
        bulk_actions: 5000
        bulk_size: 20
        flush_interval: 60
        concurrent_requests: 0
        sniff: false
        compress: true
